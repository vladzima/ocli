# Simple single-stage build
FROM golang:1.23

WORKDIR /app

# Copy everything
COPY go.mod go.sum ./
RUN go mod download

COPY *.go ./

# Build
RUN go build -o ocli-ssh-server .

# Set environment
ENV OCLI_SSH_DATA_DIR=/data
ENV OCLI_SSH_AUTO_REGISTER=true

# Create data dir
RUN mkdir -p /data

# Expose port
EXPOSE 8080

# Run
CMD ["./ocli-ssh-server"]